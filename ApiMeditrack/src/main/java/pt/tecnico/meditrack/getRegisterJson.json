"SELECT
    JSON_OBJECT(
        'patient',
        JSON_OBJECT(
            'name', p.name,
            'sex', p.sex,
            'dateOfBirth', p.dateOfBirth,
            'bloodType', p.bloodType,
            'knownAllergies', JSON_ARRAYAGG(a.allergy_name),
            'consultationRecords', JSON_ARRAYAGG(
                JSON_OBJECT(
                    'date', c.date,
                    'medicalSpeciality', c.medical_speciality,
                    'doctorName', c.doctor_name,
                    'practice', c.practice,
                    'treatmentSummary', c.treatment_summary
                )
            )
        )
    ) AS patientJson
FROM patients p
LEFT JOIN allergies a ON p.patient_id = a.patient_id
LEFT JOIN consultations c ON p.patient_id = c.patient_id
WHERE p.name = 'Bob';"